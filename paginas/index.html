<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Full Screen Landing Page</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="../style.css">
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
    <script src="http://code.jquery.com/jquery-1.10.2.js"></script>
    <script src="http://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
    <link href="../css/animate.css" rel="stylesheet" />
    <link href="../css/waypoints.css" rel="stylesheet" />
    <script src="../js/jquery.waypoints.min.js" type="text/javascript"></script>
    <script src="../js/waypoints.js" type="text/javascript"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="../css/estilos.css">

    <link href="../vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">

</head>

<body>
    <section class="intro">
        <div class="inner">
            <div class="content" id="content">
                <section class="os-animation" data-os-animation="slideInDown" data-os-animation-delay="0s">
                    <h1 class="col-log-10 mx-auto">SOFTFIELDS</h1>
                </section>
                <section class="os-animation" data-os-animation="fadeIn" data-os-animation-delay=".5s">
                    <p class="text-faded mb-5">Da un paso en comodidad, obten tu sistema de sensores y comienza a controlar el estado de tu explotación desde tu dispositivo preferido.</p>


                </section>
                <section class="os-animation" data-os-animation="slideInUp" data-os-animation-delay="0s">
                    <div class="flex">
                        <a href="#" class="bttn" onclick="ocultarLanding(); MostrarLogin()">Acceder</a>

                    </div>
                </section>
            </div>
        </div>
    </section>
    <div id="loginBox">
        <h2>Login</h2>
        <i class="fa fa-times cruz" onclick="CerrarLogin(); MostrarLanding()"></i>
        <form action='lobby.html' method="get">
            <div class="inputloginBox">
                <input type="text" id="email" name="" required="">
                <label>Username</label>
            </div>
            <div class="inputloginBox">
                <input type="password" id="password" name="" required="">
                <label>Password</label>
            </div>
            <a onclick="MostrarRecuperarPass(); CerrarLogin()">¿Has olvidado tu contraseña?</a><br><br>
            <input type="submit" onclick="procesarLogin()" name="" value="Submit">
        </form>
    </div>


    <div id="RecuperarPass">
        <h3>Recuperar Contraseña</h3>
        <i class="fa fa-times cruz" onclick="OcultarRecuperarPass(); MostrarLanding()"></i>
        <form id="formulario" class="text-faded" method="get">
            <div class="inputRecuperarPass">
                <p>Introduce tu e-mail y recibiras un correo con una nueva contraseña</p>
            </div>
            <div class="inputRecuperarPass">
                <input type="text" name="" required="">
                <label>E-mail</label>
            </div>
            <a onclick="OcultarRecuperarPass(); MostrarLogin()"><i class="fa fa-backward"></i></a>
            <input type="submit" name="" value="Submit">
        </form>
    </div>


    <footer>Copyright © Grupo 2 grado GTI</footer>

    <script>
        //Función para mostrar página de login y ocultar elementos de página landing al dar click en Acceder


        //Ocultar caja de Login
        function CerrarLogin() {
            var loginBox = document.getElementById("loginBox");
            loginBox.style.display = 'none';
        }

        //Ocultar la caja de LandingPage
        function ocultarLanding() {
            var landing = document.getElementById("content");
            landing.style.display = 'none';
        }

        //Mostrar la caja de Login
        function MostrarLogin() {
            var Login = document.getElementById("loginBox");
            Login.style.display = 'block';
        }

        //Mostrar la caja de LandingPage
        function MostrarLanding() {
            var Landing = document.getElementById("content");
            Landing.style.display = 'block';
        }


        //Mostrar la caja de recuperar pass
        function MostrarRecuperarPass() {
            var newPass = document.getElementById("RecuperarPass");
            newPass.style.display = 'block';
        }

        //Ocultar la caja de recuperar pass
        function OcultarRecuperarPass() {
            var recuperar = document.getElementById("RecuperarPass");
            recuperar.style.display = 'none';
        }

    </script>
    
    
    <script>
        function procesarLogin() {
            var email = document.getElementById("email").value;
            var contrasenya = document.getElementById("password").value;
            if (email == "" || contrasenya == "") {
                errorForm('Es obligatorio rellenar todos los campos');
            } else {
                fetch('/login?email=' + email + '&password=' + contrasenya, {
                    method: 'post'
                }).then(function(respuesta) {
                    return respuesta.json();
                }).then(function(son) {
                    if (son.status == 404 || son.status == 401) {
                        errorForm('Usuario o contraseña incorrecta');
                    } else {
                        sessionStorage.setItem('Usuario', JSON.stringify(son));
                        console.log(son.usuario.activo);
                        if (son.usuario.activo == 0) {
                            fetch('/volverUsuarioActivo?id=' + son.usuario.id, {
                                method: 'post'
                            });
                        } else {
                            window.location.href = "lobby.html";
                        } //else
                    } //else
                }) //then
            } //else
        } //procesarLogin

        function errorForm(index) {
            document.getElementById('mensajeError').innerHTML = index;
            document.getElementById('mensajeError').style.visibility = 'visible';
        }
     
    </script>
    
    
    


</body>

</html>
